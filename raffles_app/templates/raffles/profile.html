{% extends "base.html" %}
{% load static %}
{% block extra_head %} 
  <link rel="stylesheet" href="{% static 'css/profile.css' %}">
{% endblock %}
{% block content %}

<!-- =============================
      PERFIL
============================== -->
<section class="profile-section">
  <div class="profile-container">

    <!-- Card de perfil -->
    <div class="profile-card">
      <h2 class="profile-auth-title">Mi Perfil</h2>

      <div class="profile-photo">
        {% if user.profile.photo %}
          <img src="{{ user.profile.photo.url }}" alt="Foto de perfil">
        {% else %}
          <img src="{% static 'images/default-avatar.png' %}" alt="Avatar por defecto">
        {% endif %}
      </div>

      <div class="profile-data">
        <div class="profile-row">
          <span class="label">Usuario:</span>
          <span class="value">{{ user.username }}</span>
        </div>
        <div class="profile-row">
          <span class="label">Email:</span>
          <span class="value">{{ user.email }}</span>
        </div>
        <div class="profile-row">
          <span class="label">Teléfono:</span>
          <span class="value">{{ user.profile.phone|default:"-" }}</span>
        </div>
        <div class="profile-row">
          <span class="label">Ciudad:</span>
          <span class="value">{{ user.profile.city|default:"-" }}</span>
        </div>
        <div class="profile-row">
          <span class="label">Documento:</span>
          <span class="value">{{ user.profile.document_id|default:"-" }}</span>
        </div>
      </div>

      <div class="profile-actions">
        <a href="{% url 'profile_edit' %}" class="btn-main">Editar perfil</a>
      </div>
    </div>

    <!-- Tabla de tickets -->
    <div class="profile-tickets-container">
      <h3 class="profile-history-title">Mis Tickets</h3>
      {% if tickets %}
      <div class="profile-tickets-table-container">
        <table class="profile-tickets-table">
          <thead>
            <tr>
              <th>Número</th>
              <th>Rifa</th>
              <th>Fecha de compra</th>
              <th>Estado</th>
            </tr>
          </thead>
          <tbody>
            {% for ticket in tickets %}
            <tr>
              <td>#{{ ticket.number }}</td>
              <td>{{ ticket.raffle }}</td>
              <td>{{ ticket.created_at|date:"d M Y H:i" }}</td>
              <td>
                <span class="profile-ticket-status {{ ticket.payment_status|lower }}">
                  {{ ticket.payment_status }}
                </span>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
        <p class="profile-no-tickets">No tienes tickets comprados aún.</p>
      {% endif %}
    </div>

  </div>
</section>
{% endblock %}
